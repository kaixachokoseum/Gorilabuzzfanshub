<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="UTF-8">
  <title>Auth Chat App</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <script src="https://cdn.jsdelivr.net/npm/appwrite@13.0.0"></script>
</head>
<body class="bg-gray-100 min-h-screen flex items-center justify-center">
  <div class="w-full max-w-md bg-white shadow-lg rounded-xl p-6">
    <h1 class="text-2xl font-bold text-center text-blue-600 mb-6">Chat App</h1>

    <!-- ðŸ”¹ Tabs -->
    <div class="flex mb-4 border-b">
      <button id="tabLogin" class="w-1/2 py-2 text-center font-medium border-b-2 border-blue-600">Login</button>
      <button id="tabRegister" class="w-1/2 py-2 text-center font-medium text-gray-500">Register</button>
    </div>

    <!-- ðŸ”¹ Login Form -->
    <form id="loginForm" class="space-y-4">
      <input id="email" type="email" placeholder="Email" class="w-full px-3 py-2 border rounded-lg" required>
      <input id="password" type="password" placeholder="Password" class="w-full px-3 py-2 border rounded-lg" required>
      <button type="submit" class="w-full bg-blue-600 text-white py-2 rounded-lg">Login</button>
      <p class="text-center text-sm">
        <a href="#" id="resetPassword" class="text-blue-500 hover:underline">Lupa password?</a>
      </p>
    </form>

    <!-- ðŸ”¹ Register Form -->
    <form id="registerForm" class="space-y-4 hidden">
      <input id="regName" type="text" placeholder="Nama Lengkap" class="w-full px-3 py-2 border rounded-lg" required>
      <input id="regEmail" type="email" placeholder="Email" class="w-full px-3 py-2 border rounded-lg" required>
      <input id="regPass" type="password" placeholder="Password" class="w-full px-3 py-2 border rounded-lg" required>
      <button type="submit" class="w-full bg-green-600 text-white py-2 rounded-lg">Daftar</button>
    </form>
  </div>

  <script>
    // ðŸ”¹ Inisialisasi Appwrite
    const client = new Appwrite.Client()
      .setEndpoint("https://fra.cloud.appwrite.io/v1") // ganti kalau pakai self-hosted
      .setProject("68d2932c00121f4a3800"); // ganti dengan Project ID kamu

    const account = new Appwrite.Account(client);

    // ðŸ”¹ Tab switching
    const tabLogin = document.getElementById("tabLogin");
    const tabRegister = document.getElementById("tabRegister");
    const loginForm = document.getElementById("loginForm");
    const registerForm = document.getElementById("registerForm");

    tabLogin.addEventListener("click", () => {
      loginForm.classList.remove("hidden");
      registerForm.classList.add("hidden");
      tabLogin.classList.add("border-blue-600", "text-blue-600");
      tabRegister.classList.remove("border-blue-600", "text-blue-600");
      tabRegister.classList.add("text-gray-500");
    });

    tabRegister.addEventListener("click", () => {
      registerForm.classList.remove("hidden");
      loginForm.classList.add("hidden");
      tabRegister.classList.add("border-blue-600", "text-blue-600");
      tabLogin.classList.remove("border-blue-600", "text-blue-600");
      tabLogin.classList.add("text-gray-500");
    });

    
    //  Login
loginForm.addEventListener("submit", async (e) => {
  e.preventDefault();
  const email = document.getElementById("email").value;
  const password = document.getElementById("password").value;

  try {
    await account.createEmailSession(email, password); //  pakai ini
    window.location.href = "chat.html";
  } catch (error) {
    alert("Login gagal: " + error.message);
  }
});

    // ðŸ”¹ Register
    registerForm.addEventListener("submit", async (e) => {
      e.preventDefault();
      const name = document.getElementById("regName").value;
      const email = document.getElementById("regEmail").value;
      const pass = document.getElementById("regPass").value;

      try {
        await account.create("unique()", email, pass, name);
        alert("Registrasi berhasil, silakan login!");
        tabLogin.click(); // otomatis balik ke tab login
      } catch (error) {
        alert("Registrasi gagal: " + error.message);
      }
    });

    // ðŸ”¹ Reset password
    document.getElementById("resetPassword").addEventListener("click", async () => {
      const email = prompt("Masukkan email untuk reset password:");
      if (!email) return;

      try {
        await account.createRecovery(email, window.location.origin + "/reset.html");
        alert("Link reset password telah dikirim ke email kamu.");
      } catch (error) {
        alert("Gagal reset password: " + error.message);
      }
    });
  </script>
</body>
</html>
